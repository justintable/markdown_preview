<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 预览 (自动处理 \n)</title>
    <style>
        /* --- 页面整体布局 --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f9;
            color: #333;
        }

        /* --- 头部标题 --- */
        header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 30px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        header h1 {
            margin: 0;
            font-size: 1.8em;
        }

        /* --- 主内容区，左右分栏 --- */
        .container {
            display: flex;
            flex-wrap: wrap;
            padding: 20px;
            gap: 20px;
            height: calc(100vh - 80px);
        }

        /* --- 编辑区和预览区共享样式 --- */
        .panel {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .panel h2 {
            margin: 0;
            padding: 15px 20px;
            font-size: 1.2em;
            background-color: #ecf0f1;
            border-bottom: 1px solid #dcdfe2;
            color: #2c3e50;
        }
        
        /* --- 输入框样式 --- */
        #markdown-input {
            flex-grow: 1;
            border: none;
            outline: none;
            padding: 20px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 16px;
            line-height: 1.6;
            resize: none;
            color: #222;
        }

        /* --- 预览区样式 --- */
        #html-output {
            flex-grow: 1;
            padding: 20px;
            line-height: 1.7;
            overflow-y: auto;
        }

        /* --- 预览区内元素的精细化样式 --- */
        #html-output h1, #html-output h2, #html-output h3 { border-bottom: 1px solid #eee; padding-bottom: 0.3em; margin-top: 24px; }
        #html-output code { background-color: #eef; padding: 2px 5px; border-radius: 4px; font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
        #html-output pre { background-color: #eef; padding: 15px; border-radius: 4px; overflow-x: auto; }
        #html-output blockquote { border-left: 4px solid #ccc; padding-left: 15px; color: #666; margin-left: 0; }
        #html-output table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        #html-output th, #html-output td { border: 1px solid #dfe2e5; padding: 10px 12px; }
        #html-output th { background-color: #f6f8fa; font-weight: bold; }
        #html-output img { max-width: 100%; }

    </style>
</head>
<body>

    <header>
        <h1>Markdown 预览 (自动处理 `\n`)</h1>
    </header>

    <div class="container">
        <div class="panel">
            <h2>输入 Markdown 原始内容</h2>
            <textarea id="markdown-input">**Part 1 - Equipment Table**\n\n| Component | Specification |\n|---|---|\n| Life Raft | 4 × Inflatable type (45P).\n1 × Inflatable type (6P) |\n\n**Part 2**\n*   Warning 1\n*   Warning 2</textarea>
        </div>

        <div class="panel">
            <h2>正常 Markdown 格式预览</h2>
            <div id="html-output"></div>
        </div>
    </div>

    <!-- 1. 引入 Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- 2. 引入 DOMPurify (用于安全) -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

    <!-- 3. 我们自己的脚本 -->
    <script>
        // 配置 Marked.js
        marked.setOptions({
            gfm: true,
            breaks: true,
            pedantic: false,
        });

        // 获取 DOM 元素
        const markdownInput = document.getElementById('markdown-input');
        const htmlOutput = document.getElementById('html-output');

        // 定义渲染函数
        function renderMarkdown() {
            // 1. 获取输入框中的原始内容
            const rawMarkdownText = markdownInput.value;
            
            // 2.【核心自动化处理】
            //    在将文本送去解析之前，先在内存中将所有的 '\\n' 字符串替换为真正的换行符 '\n'。
            //    这不会改变输入框中的内容，保证了用户的编辑体验。
            const processedMarkdownText = rawMarkdownText.replace(/\\n/g, '\n');

            // 3. 使用处理后的文本来生成 HTML
            const dirtyHtml = marked.parse(processedMarkdownText);
            
            // 4. (安全第一!) 净化生成的 HTML
            const cleanHtml = DOMPurify.sanitize(dirtyHtml);

            // 5. 将结果渲染到预览区
            htmlOutput.innerHTML = cleanHtml;
        }

        // 首次加载时，立即渲染一次
        renderMarkdown();

        // 监听输入事件，每当用户输入或粘贴时，都自动重新渲染
        markdownInput.addEventListener('input', renderMarkdown);
    </script>

</body>
</html>